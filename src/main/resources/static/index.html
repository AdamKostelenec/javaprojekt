<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Správa přepravní společnosti</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .tab { display: none; }
        .tab.active { display: block; }
        .tabs button { margin-right: 5px; padding: 8px 12px; }
        label { display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 5px; margin-top: 5px; }
        .tab-content { display: flex; gap: 20px; margin-top: 20px; }
        .form-column { flex: 1; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        button { margin-top: 10px; padding: 8px 12px; }
    </style>
</head>
<body>
<h1>Správa přepravní společnosti</h1>

<div class="tabs">
    <button onclick="showTab('tahac')">Tahač</button>
    <button onclick="showTab('ridic')">Řidič</button>
    <button onclick="showTab('firma')">Firma</button>
    <button onclick="showTab('zakazka')">Zakázka</button>
    <button onclick="showTab('servis')">Servis</button>
    <button onclick="showTab('cesta')">Cesta</button>
    <button onclick="showTab('palivo')">Palivo</button>
    <button onclick="showTab('typ')">Typ kontroly</button>
    <button onclick="showTab('kontrola')">Kontrola</button>
    <button onclick="showTab('naklad')">Náklad</button>
    <button onclick="showTab('prirazeni')">Přiřazení</button>
</div>

<div id="tabsContainer">
    <!-- Budou doplněny JavaScriptem -->
</div>

<script>
    // Definice záložek a jejich polí
    const tabs = [
        'tahac', 'ridic', 'firma', 'zakazka', 'servis',
        'cesta', 'palivo', 'typ', 'kontrola', 'naklad', 'prirazeni'
    ];

    const fields = {
        tahac: [
            { name: 'znacka', label: 'Značka', type: 'text' },
            { name: 'model', label: 'Model', type: 'text' },
            { name: 'spz', label: 'SPZ', type: 'text' },
            { name: 'stavKm', label: 'Stav KM', type: 'number' },
            { name: 'stk', label: 'STK', type: 'date' },
            { name: 'dalnicniZnamka', label: 'Dálniční známka', type: 'date' },
            { name: 'registraceDatum', label: 'Datum registrace', type: 'date' }
        ],
        ridic: [
            { name: 'jmeno', label: 'Jméno', type: 'text' },
            { name: 'prijmeni', label: 'Příjmení', type: 'text' },
            { name: 'datumNarozeni', label: 'Datum narození', type: 'date' },
            { name: 'zamestnanOd', label: 'Zaměstnán od', type: 'date' },
            { name: 'tahacId', label: 'ID tahače', type: 'number' }
        ],
        firma: [
            { name: 'nazev', label: 'Název', type: 'text' },
            { name: 'adresa', label: 'Adresa', type: 'text' },
            { name: 'ico', label: 'IČO', type: 'text' },
            { name: 'bankdetails', label: 'Bankovní spojení', type: 'text' }
        ],
        zakazka: [
            { name: 'cena', label: 'Cena', type: 'number' },
            { name: 'ridicId', label: 'ID řidiče', type: 'number' },
            { name: 'tahacId', label: 'ID tahače', type: 'number' },
            { name: 'status', label: 'Status', type: 'text' },
            { name: 'destinace', label: 'Destinace', type: 'text' },
            { name: 'vytvoreno', label: 'Vytvořeno', type: 'date' }
        ],
        servis: [
            { name: 'tahacId', label: 'ID tahače', type: 'number' },
            { name: 'datum', label: 'Datum', type: 'date' },
            { name: 'popis', label: 'Popis', type: 'text' },
            { name: 'cena', label: 'Cena', type: 'number' }
        ],
        cesta: [
            { name: 'tahacId', label: 'ID tahače', type: 'number' },
            { name: 'ridicId', label: 'ID řidiče', type: 'number' },
            { name: 'start', label: 'Začátek', type: 'datetime-local' },
            { name: 'konec', label: 'Konec', type: 'datetime-local' },
            { name: 'vzdalenostKm', label: 'Vzdálenost (km)', type: 'number' }
        ],
        palivo: [
            { name: 'tahacId', label: 'ID tahače', type: 'number' },
            { name: 'datum', label: 'Datum', type: 'date' },
            { name: 'mnozstviLitry', label: 'Množství (l)', type: 'number' },
            { name: 'cena', label: 'Cena', type: 'number' }
        ],
        typ: [
            { name: 'popis', label: 'Popis', type: 'text' }
        ],
        kontrola: [
            { name: 'tahacId', label: 'ID tahače', type: 'number' },
            { name: 'typ', label: 'Typ kontroly (ID)', type: 'number' },
            { name: 'vysledek', label: 'Výsledek', type: 'text' },
            { name: 'dalsiKontrola', label: 'Další kontrola', type: 'date' }
        ],
        naklad: [
            { name: 'zakazkaId', label: 'ID zakázky', type: 'number' },
            { name: 'cestaId', label: 'ID cesty', type: 'number' },
            { name: 'popis', label: 'Popis', type: 'text' },
            { name: 'cena', label: 'Cena', type: 'number' }
        ],
        prirazeni: [
            { name: 'ridicId', label: 'ID řidiče', type: 'number' },
            { name: 'tahacId', label: 'ID tahače', type: 'number' },
            { name: 'prirazenoOd', label: 'Přiřazeno od', type: 'datetime-local' },
            { name: 'prirazenoDo', label: 'Přiřazeno do', type: 'datetime-local' }
        ]
    };

    // Vytvoření UI pro každou záložku
    tabs.forEach(tabId => {
        const container = document.createElement('div');
        container.id = tabId;
        container.className = 'tab';

        const title = document.createElement('h2');
        title.textContent = tabId.charAt(0).toUpperCase() + tabId.slice(1);
        container.appendChild(title);

        const content = document.createElement('div');
        content.className = 'tab-content';

        // Formulář
        const formCol = document.createElement('div');
        formCol.className = 'form-column';
        fields[tabId].forEach(field => {
            const label = document.createElement('label');
            label.textContent = field.label + ':';
            const input = document.createElement('input');
            input.id = tabId + field.name.charAt(0).toUpperCase() + field.name.slice(1);
            input.type = field.type;
            label.appendChild(input);
            formCol.appendChild(label);
        });
        const btnSave = document.createElement('button');
        btnSave.textContent = 'Uložit';
        btnSave.id = 'btnSave' + tabId;
        const btnLoad = document.createElement('button');
        btnLoad.textContent = 'Načíst';
        btnLoad.id = 'btnLoad' + tabId;
        formCol.appendChild(btnSave);
        formCol.appendChild(btnLoad);

        // Tabulka
        const tableCol = document.createElement('div');
        tableCol.className = 'form-column';
        const table = document.createElement('table');
        const thead = document.createElement('thead');
        const headRow = document.createElement('tr');
        fields[tabId].forEach(field => {
            const th = document.createElement('th');
            th.textContent = field.label;
            headRow.appendChild(th);
        });
        const thAction = document.createElement('th');
        thAction.textContent = 'Akce';
        headRow.appendChild(thAction);
        thead.appendChild(headRow);
        table.appendChild(thead);
        const tbody = document.createElement('tbody');
        tbody.id = tabId + 'Tbody';
        table.appendChild(tbody);
        tableCol.appendChild(table);

        content.appendChild(formCol);
        content.appendChild(tableCol);
        container.appendChild(content);
        document.getElementById('tabsContainer').appendChild(container);
    });

    // Zobrazení a CRUD logika
    function showTab(id) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // Mapování názvů na endpointy
    const apiMap = {
        tahac: 'tahace', ridic: 'ridici', firma: 'firmy', zakazka: 'zakazky', servis: 'servisy',
        cesta: 'cesty', palivo: 'paliva', typ: 'typy-kontrol', kontrola: 'kontroly', naklad: 'naklady', prirazeni: 'prirazeni'
    };

    document.addEventListener('DOMContentLoaded', () => {
        tabs.forEach(tabId => {
            document.getElementById('btnLoad' + tabId)
                .addEventListener('click', () => loadEntity(tabId));
            document.getElementById('btnSave' + tabId)
                .addEventListener('click', () => saveEntity(tabId));
        });
        showTab('tahac');
    });

    async function loadEntity(tabId) {
        const res = await fetch(`/api/${apiMap[tabId]}`);
        const data = await res.json();
        const tbody = document.getElementById(tabId + 'Tbody');
        tbody.innerHTML = '';
        data.forEach(item => {
            const tr = document.createElement('tr');
            fields[tabId].forEach(field => {
                const td = document.createElement('td');
                td.textContent = item[field.name] || '';
                tr.appendChild(td);
            });
            const tdAction = document.createElement('td');
            const btnDel = document.createElement('button');
            btnDel.textContent = 'Smazat';
            btnDel.addEventListener('click', () => deleteEntity(tabId, item.id));
            tdAction.appendChild(btnDel);
            tr.appendChild(tdAction);
            tbody.appendChild(tr);
        });
    }

    async function saveEntity(tabId) {
        const payload = {};
        fields[tabId].forEach(field => {
            const input = document.getElementById(tabId + field.name.charAt(0).toUpperCase() + field.name.slice(1));
            payload[field.name] = input.value || null;
        });
        await fetch(`/api/${apiMap[tabId]}`, {
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload)
        });
        loadEntity(tabId);
    }

    async function deleteEntity(tabId, id) {
        await fetch(`/api/${apiMap[tabId]}/${id}`, {method: 'DELETE'});
        loadEntity(tabId);
    }
</script>
</body>
</html>
